<html>
<head>
    <title>Iframe-buster</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=2">
    <link type="text/css" rel="stylesheet" href="css/style.css"/>
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>

</head>
<body>

    <div class="container">
        <div class="row">
            <div class="col s12">
                <h1 class="red-text text-lighten-2">IFRAME <span class="buster red-text text-lighten-1">BUSTER</span></h1>
            </div>
        </div>

        <div class="row">
            <form class="col s12">
                <div class="row">
                    <div class="input-field col s6">
                        <input id="inputWidth" type="text" class="validate" >
                        <label for="inputWidth">Width</label>
                    </div>
                    <div class="input-field col s6">
                        <input id="inputHeight" type="text" class="validate" >
                        <label for="inputHeight">Height</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input id="inputScriptSrc" type="email" class="validate" >
                        <label for="inputScriptSrc">Script src</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s6">
                        <button class="generateBtn btn waves-effect waves-light" type="submit" name="action">
                            Generate
                            <i class="mdi-content-send right"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <div class="row">
            <div class="col s12">
                <h3 class="red-text text-lighten-2">Generated code:</h3>
            </div>
        </div>
        <div class="row">
            <div class="input-field col s12">
                <textarea id="result" readonly="true" cols="55" rows="35" class="materialize-textarea" style="height: 300px;"></textarea>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function () {


            $('.generateBtn').on('click', function (e) {
                e.preventDefault();
                var now = new Date().getTime(),
                    frameID = generateHash(now.toString()).toString(),
                    frameEl = 'frame' + frameID,
                    scriptEl = 'bootstrapScript' + frameID,
                    frameWidth = document.getElementById('inputWidth').value,
                    frameHeight = document.getElementById('inputHeight').value;
                    frameWidth = frameWidth ? frameWidth : '100%';
                    frameHeight = frameHeight ? frameHeight : '250';

                // Show the iframe they should use.
                var resultVal = '<iframe id="' + frameEl + '" scrolling="no" frameborder="0"' +
                'width="' + frameWidth + '" height="' + frameHeight + '" allowfullscreen="true"' +
                'mozallowfullscreen="true" webkitallowfullscreen="true" src="about:self"' +
                'style="border: 0px;"><\/iframe>';
                // Show the script they should use.
                resultVal += '\n\n<script type="text/javascript">';
                resultVal += '\nvar ' + frameEl + ' = document.getElementById("' + frameEl + '");';
                resultVal += '\nvar document' + frameID + ' = ' + frameEl +  '.contentDocument || ' + frameEl + '.contentWindow;';
                resultVal += '\nvar ' + scriptEl + ' = document.createElement("script");';
                resultVal += '\n' + scriptEl + '.src = "' + $('#inputScriptSrc').val() + '";';
                resultVal += '\ndocument' + frameID + '.body.appendChild(' + scriptEl + ');';
                resultVal += '\n<\/script>';
                $('#result').val(resultVal);
            });


            function generateHash (toBeHashed) {

                var hash = 0, i, chr, len;
                if (toBeHashed.length == 0) return hash;
                for (i = 0, len = toBeHashed.length; i < len; i++) {
                    chr   = toBeHashed.charCodeAt(i);
                    hash  = (hash*37) + chr;
                    hash |= 0;
                }

                return Math.abs(hash);
            }

        });
    </script>

    <script type="text/javascript" src="js/materialize.js"></script>
</body>
</html>